# Database Migration Environment Configuration Template
# Copy this to .env and fill in your actual connection strings

# ============================================================================
# PRIMARY DATABASE (Supabase)
# ============================================================================
# This is your source of truth for all data and the target of all writes
# Get this from: Supabase Dashboard → Project Settings → Database → URI

DATABASE_URL=postgresql://user:password@db.supabase.co:5432/postgres?sslmode=require

# ============================================================================
# READ REPLICA DATABASE (Railway) - OPTIONAL
# ============================================================================
# This is for read-only operations and backup availability
# Get this from: Railway → PostgreSQL service → Connect tab
# 
# Leave unset initially - only configure after migration is complete

# DATABASE_REPLICA_URL=postgresql://user:password@railway-db.railway.app:5432/railway

# ============================================================================
# CONNECTION POOL SETTINGS
# ============================================================================
# These control how many connections are maintained to each database
# Adjust based on your application's concurrency needs

DB_PRIMARY_POOL_SIZE=10
DB_REPLICA_POOL_SIZE=10

# ============================================================================
# ENVIRONMENT
# ============================================================================
# Use 'development' for local testing, 'production' for deployed app

NODE_ENV=development

# ============================================================================
# MIGRATION SETTINGS
# ============================================================================
# These are optional settings for the migration process

# Skip data integrity verification after migration (not recommended)
# MIGRATION_SKIP_VERIFICATION=false

# Only migrate specific tables (comma-separated)
# MIGRATION_TABLES=users,search_alerts

# ============================================================================
# REPLICATION SETTINGS
# ============================================================================
# These are optional settings for logical replication setup

# Publication name on primary database
# REPLICATION_PUBLICATION_NAME=airbnb_alerts_pub

# Subscription name on replica database
# REPLICATION_SUBSCRIPTION_NAME=airbnb_alerts_sub

# ============================================================================
# HEALTH CHECK SETTINGS
# ============================================================================
# Control database health monitoring

# Health check interval in milliseconds
HEALTH_CHECK_INTERVAL=30000

# Latency warning threshold (milliseconds)
HEALTH_CHECK_WARNING_THRESHOLD=100

# Latency critical threshold (milliseconds)
HEALTH_CHECK_CRITICAL_THRESHOLD=500

# ============================================================================
# NOTES FOR SETUP
# ============================================================================
#
# STEP 1: Create Supabase Database
#   - Go to https://app.supabase.com
#   - Create a new project
#   - Wait for database to initialize
#   - Copy connection string from Project Settings → Database → URI
#   - Fill in DATABASE_URL above
#
# STEP 2: Get Railway Connection String
#   - Go to https://railway.app
#   - Select your PostgreSQL service
#   - Click "Connect" tab
#   - Copy the PostgreSQL connection string
#   - Save this for migration phase
#
# STEP 3: Run Migration (from project root)
#   export DATABASE_REPLICA_URL="your-railway-connection-string"
#   export DATABASE_URL="your-supabase-connection-string"
#   npm run migrate:to-supabase
#
# STEP 4: Setup Replication (optional)
#   - Update .env with DATABASE_REPLICA_URL
#   - npm run setup:replication
#   - Monitor: npm run db:health
#
# STEP 5: Update Application Code
#   - Replace imports from src/db/index.js with src/db/config.js
#   - Test thoroughly in development
#   - Deploy to staging
#   - Monitor for 24-48 hours
#   - Roll out to production
#
# ============================================================================
# SECURITY REMINDERS
# ============================================================================
#
# ⚠️  NEVER commit this file with real credentials to git
# ⚠️  Add .env to .gitignore
# ⚠️  In production, use environment variable management:
#    - Vercel Secrets (if using Vercel)
#    - Railway Variables (if using Railway)
#    - AWS Secrets Manager (if using AWS)
#    - Google Cloud Secret Manager (if using GCP)
#    - Azure Key Vault (if using Azure)
#
# ✅ Best practices:
#    - Rotate passwords regularly
#    - Use different passwords for dev/staging/production
#    - Restrict IP access to databases
#    - Enable SSL/TLS for connections
#    - Keep backups in secure location
#
# ============================================================================
